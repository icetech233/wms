@namespace MyAntDesignApp2.Pages.Settings
@page "/settings/attrs"

@using MyAntDesignApp2.Models
@using System.ComponentModel.DataAnnotations

@inject NotificationService _notice

<GridContent Id="#main">

    <Alert Message=@_attrPageKey Type="success"
           ShowIcon="true"
           Style="margin-bottom:12px" />

    <Space Style="margin-bottom:12px"
           Size=@("middle")>
        <SpaceItem>
            <Button Color=@Color.Blue7 Icon="@IconType.Fill.PlusCircle"
                    Type="@ButtonType.Primary"
                    OnClick="(e)=>AddAttr()">
                新增
            </Button>

            <Button Color=@Color.Green4 Icon="@IconType.Outline.Reload"
                    Type="@ButtonType.Primary"
                    OnClick="Refresh">
                刷新
            </Button>
        </SpaceItem>
    </Space>

    <Table TItem="Attr" DataSource="@attrList" HidePagination>
        <Column Title="属性ID" @bind-Field="@context.AttrID" />
        <Column Title="属性名称" @bind-Field="@context.AttrName" />

        <PropertyColumn Property="c=>c.Val">

            @if (context.Val?.Count > 0)
            {
                foreach (AttrValue tag in context.Val)
                {
                    PresetColor c1 = (PresetColor)Random.Shared.Next(13);
                    var color = c1.ToString();
                    // color = "#3b5999";
                    <Tag Color="@color">@tag.AttrValueName</Tag>
                }

            }
            else
            {
                <span>-</span>
                @* <Tag Color="red-inverse">@("无")</Tag> *@
            }
        </PropertyColumn>


        <PropertyColumn Property="c=>c.CreatedAt"
                            Sortable />
         <PropertyColumn Property="c=>c.UpdatedAt"
                            Sortable></PropertyColumn>

         <ActionColumn Title="操作">
             <Space>
                 <SpaceItem>
                     <Button OnClick="(e)=>EditAttr(context)">编辑</Button>
                 </SpaceItem>
                 <SpaceItem>
                     <Button Danger Icon="@IconType.Fill.Delete"
                             Type="@ButtonType.Primary"
                             OnClick="(e)=>Delete(context.AttrID)" />
                 </SpaceItem>
             </Space>
         </ActionColumn>

     </Table>
 </GridContent>

 <Modal Title=@modalTitle Keyboard=false MaskClosable=false Closable=false
        @bind-Visible="@_visible">

     <Form Model="@model"
           LabelColSpan="8" WrapperColSpan="14">
         <FormItem Label="规格名">
             <Input Placeholder="请输入" @bind-Value="@context.AttrName"></Input>
         </FormItem> 
         <Divider ></Divider>
             @foreach (AttrValue tmpattr in context.Val)
            {
            <FormItem Label="值">
                    <Input Placeholder="请输入" @bind-Value="tmpattr.AttrValueName" />
                    <Button Icon="@IconType.Fill.Delete" />
                </FormItem>
            }



     </Form>
     <a>数据内容</a>
 </Modal>

 @code {

    private AttrModel model = new();

    public class AttrModel
    {
        [System.ComponentModel.DataAnnotations.Required]
        [StringLength(10, MinimumLength = 1)]
        public string AttrName { get; set; }

        [MinLength(1, ErrorMessage = "属性值最小数量1")]
        public List<AttrValue> Val { get; set; }

        public bool RememberMe { get; set; } = true;
    }

    private void AddAttr()
    {
        // 清空数据
        modalTitle = "添加规格";
        _visible = true;
        //
    }

    private async void EditAttr(Attr attr)
    {
        modalTitle = "编辑规格";
        if (attr == null)
        {
            await NoticeWithIcon("无数据");
        }

        model.AttrName = attr.AttrName;
        model.Val = attr.Val;
        _visible = true;
    }

    private void Delete(long id)
    {
        // 请求网络 delete 接口
        attrList = attrList.Where(x => x.AttrID != id).ToArray();

        // 删除按钮
        // https://antblazor.com/zh-CN/components/tag
    }

}